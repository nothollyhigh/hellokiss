window.__require=function e(n,t,o){function c(a,r){if(!t[a]){if(!n[a]){var i=a.split("/");if(i=i[i.length-1],!n[i]){var l="function"==typeof __require&&__require;if(!r&&l)return l(i,!0);if(s)return s(i,!0);throw new Error("Cannot find module '"+a+"'")}}var u=t[a]={exports:{}};n[a][0].call(u.exports,function(e){return c(n[a][1][e]||e)},u,u.exports,e,n,t,o)}return t[a].exports}for(var s="function"==typeof __require&&__require,a=0;a<o.length;a++)c(o[a]);return c}({Plaza:[function(e,n,t){"use strict";cc._RF.push(n,"64a2bEL+lJI/46u2keYJw9T","Plaza");var o=e("Websocket");cc.Class({extends:cc.Component,properties:{count:0,wsUrl:"ws://localhost:8888/plaza/ws",CMD_PING:1<<24,CMD_LOGIN_REQ:1,CMD_LOGIN_RSP:2,CMD_BROADCAST_NOTIFY:3},onLoad:function(){cc.plazaWs||(cc.plazaHandlers||(cc.plazaHandlers={}),cc.plazaWs=new o,cc.plazaWs.init(this),cc.plazaWs.handle(this,this.CMD_LOGIN_RSP,this.onLoginRsp),cc.plazaWs.handle(this,this.CMD_BROADCAST_NOTIFY,this.onBroadcastNotify))},onWsOpen:function(e){cc.plazaWs&&(cc.log("Plaza onWsOpen"),e.keepalive||(e.keepalive=!0,e.schedule(function(){cc.plazaWs&&cc.plazaWs.sendMsg(e.CMD_PING)},30)),cc.plazaWs.sendMsg(e.CMD_LOGIN_REQ,{}))},onWsClose:function(e){cc.log("Plaza onWsClose",new Date),e.scheduleOnce(function(){cc.plazaWs.init(e)},1)},onWsError:function(e){cc.log("Plaza onWsError")},onLoginRsp:function(e,n,t){(e.count++,cc.log("Plaza onLoginRsp cmd:",n,"data:",t,e.count),e.textNode)||(e.textNode=new cc.Node("Label"),e.textNode.addComponent(cc.Label).string=t.msg,e.textNode.color=new cc.Color(0,0,255),e.textNode.parent=e.node,e.textNode.setPosition(0,200))},onBroadcastNotify:function(e,n,t){e.count++,e.textNode.getComponent(cc.Label).string=t.msg,cc.log("Plaza onBroadcastNotify cmd:",n,"data:",t,e.count)},update:function(e){}}),cc._RF.pop()},{Websocket:"Websocket"}],Websocket:[function(e,n,t){"use strict";cc._RF.push(n,"84d10f59ZVCg5Szb7//yxpQ","Websocket");var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var c=function(){function e(){(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")})(this,e)}return o(e,[{key:"init",value:function(e){var n=this;n.wsImpl=e,n.CmdPing=1<<24,n.SOCK_STATE_CLOSED=0,n.SOCK_STATE_CONNECTING=1,n.SOCK_STATE_CONNECTED=2,n.state=n.SOCK_STATE_CONNECTING;try{"WebSocket"in window?n.ws=new WebSocket(e.wsUrl):"MozWebSocket"in window?n.ws=new MozWebSocket(e.wsUrl):n.ws=new SockJS(e.wsUrl),n.state=n.SOCK_STATE_CONNECTING,n.ws.onopen=function(t){n.state=n.SOCK_STATE_CONNECTED,e.onWsOpen&&e.onWsOpen(e)},n.ws.onclose=function(t){e.onWsClose&&e.onWsClose(e),n.ws.close(),n.state!=n.SOCK_STATE_CLOSED&&(n.state=n.SOCK_STATE_CONNECTING)},n.ws.onerror=function(n){e.onWsError&&e.onWsError(e)},n.ws.onmessage=function(e){try{var t,o=new TextEncoder("utf-8").encode(e.data.slice(0,16)),c=(o[0],o[1],o[2],o[3],o[4]|o[5]<<8|o[6]<<16|o[7]<<24);if(c==n.CmdPing)return;e.data.length>16&&(t=JSON.parse(e.data.slice(16,e.data.length))),n.onMessage(c,t)}catch(e){cc.log("Websocket onmessage panic:",e)}}}catch(e){cc.log("Websocket constructor failed:",e)}}},{key:"handle",value:function(e,n,t){this.handlers||(this.handlers={}),this.handlers[n]={instance:e,cb:t}}},{key:"onMessage",value:function(e,n){if(this.handlers){var t=this.handlers[e];t?t.cb(t.instance,e,n):cc.log("Plaza no handler for cmd:",e)}}},{key:"sendMsg",value:function(e,n){if(this.state==this.SOCK_STATE_CONNECTED){if(this.ws){var t,o=0;n&&(o=(t=new TextEncoder("utf-8").encode(JSON.stringify(n))).length);var c=new Uint8Array(16+o);if(c[0]=o%256,c[1]=(o>>8)%256,c[2]=(o>>16)%256,c[3]=(o>>24)%256,c[4]=e%256,c[5]=(e>>8)%256,c[6]=(e>>16)%256,c[7]=(e>>24)%256,t)for(var s=0;s<o;s++)c[16+s]=t[s];this.ws.send(c)}}else cc.log("sendMsg failed: websocket disconnected")}},{key:"shutdown",value:function(){self.ws.close(),self.state=self.SOCK_STATE_CLOSED}}]),e}();n.exports=c,cc._RF.pop()},{}]},{},["Plaza","Websocket"]);